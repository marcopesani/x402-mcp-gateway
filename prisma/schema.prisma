generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String           @id @default(uuid())
  email           String?          @unique
  walletAddress   String?          @unique
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  hotWallet       HotWallet?
  spendingPolicy  SpendingPolicy?
  transactions    Transaction[]
  pendingPayments PendingPayment[]
}

model HotWallet {
  id                  String   @id @default(uuid())
  address             String   @unique
  encryptedPrivateKey String
  userId              String   @unique
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model SpendingPolicy {
  id                   String   @id @default(uuid())
  perRequestLimit      Float    @default(0.10)
  perHourLimit         Float    @default(1.00)
  perDayLimit          Float    @default(10.00)
  wcApprovalLimit      Float    @default(5.00)
  whitelistedEndpoints String   @default("[]")
  blacklistedEndpoints String   @default("[]")
  userId               String   @unique
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

model Transaction {
  id        String   @id @default(uuid())
  amount    Float
  endpoint  String
  txHash    String?
  network   String   @default("base")
  status    String   @default("pending")
  type      String   @default("payment")
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model PendingPayment {
  id                  String   @id @default(uuid())
  userId              String
  url                 String
  method              String   @default("GET")
  amount              Float
  paymentRequirements String   // JSON string of PaymentRequirements
  status              String   @default("pending") // pending, approved, rejected, expired
  signature           String?  // The EIP-712 signature once approved
  expiresAt           DateTime
  createdAt           DateTime @default(now())
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
